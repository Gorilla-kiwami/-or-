<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ã‚¢ã‚¤ã‚³ãƒ³è¦‹åˆ†ã‘ã‚²ãƒ¼ãƒ  - é€²æ—20é€£ç¶šï¼†ç¶™ç¶šç®¡ç†</title>
<style>
  /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ */
  body {
    margin: 0;
    font-family: sans-serif;
    background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
    height: 100vh;
    display: flex;
    color: #fff;
  }
  /* å·¦ã®é€²æ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
  #achievement-menu {
    width: 220px;
    background: rgba(0,0,0,0.3);
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  #achievement-menu h2 {
    margin-top: 0;
    font-size: 20px;
    border-bottom: 1px solid #fff;
    padding-bottom: 8px;
  }
  #achievement-menu ul {
    list-style: none;
    padding-left: 0;
    max-height: 80vh;
    overflow-y: auto;
  }
  #achievement-menu li {
    margin: 6px 0;
    font-size: 14px;
  }
  #achievement-menu li.unlocked {
    color: #00ff99;
    font-weight: bold;
  }
  #achievement-menu li.locked {
    color: #ccc;
  }

  /* ã‚²ãƒ¼ãƒ éƒ¨åˆ† */
  #game-wrapper {
    flex-grow: 1;
    padding: 20px;
    box-sizing: border-box;
    text-align: center;
  }

  #game-area {
    margin: 20px auto;
    width: 300px;
    height: 300px;
    border: 2px solid white;
    position: relative;
    background: rgba(255,255,255,0.15);
    border-radius: 12px;
  }
  .icon {
    width: 30px;
    height: 30px;
    object-fit: cover;
    position: absolute;
    cursor: default;
  }
  #buttons {
    margin-top: 15px;
  }
  button {
    font-size: 18px;
    padding: 8px 20px;
    margin: 0 10px 10px 10px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background-color: #007bff;
    color: white;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #0056b3;
  }
  button:disabled {
    background-color: #666;
    cursor: not-allowed;
  }
  #timer {
    font-size: 20px;
    margin-top: 10px;
    font-weight: bold;
  }
  #mode-buttons {
    margin: 15px 0;
  }

  /* é€²æ—é€šçŸ¥ã‚¹ã‚¿ã‚¤ãƒ« */
  .achievement {
    position: fixed;
    top: 20px;
    right: -300px;
    background-color: #00c300;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 16px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: right 0.5s ease;
    z-index: 999;
  }
  .achievement.show {
    right: 20px;
  }
</style>
</head>
<body>

  <div id="achievement-menu">
    <h2>é€²æ—ä¸€è¦§</h2>
    <ul id="achievement-list"></ul>
  </div>

  <div id="game-wrapper">
    <h1>ã‚¢ã‚¤ã‚³ãƒ³è¦‹åˆ†ã‘ã‚²ãƒ¼ãƒ </h1>
    <p>ã‚¹ã‚³ã‚¢: <span id="score">0</span></p>
    <p>10ç§’ãƒ¢ãƒ¼ãƒ‰æœ€é«˜ã‚¹ã‚³ã‚¢: <span id="best-score">0</span></p>
    <div id="game-area"></div>

    <div id="buttons">
      <button id="mania-btn" disabled>ãƒãƒ‹ã‚¢ (Fã‚­ãƒ¼)</button>
      <button id="senior-btn" disabled>ã‚·ãƒ‹ã‚¢ (Jã‚­ãƒ¼)</button>
    </div>

    <div id="mode-buttons">
      <button id="start-normal-btn">é€šå¸¸ãƒ¢ãƒ¼ãƒ‰é–‹å§‹</button>
      <button id="start-10sec-btn">10ç§’ãƒ¢ãƒ¼ãƒ‰é–‹å§‹</button>
    </div>

    <div id="timer"></div>
  </div>

  <div id="achievement-container"></div>

<script>
  let score = 0;
  let bestScore10sec = 0;
  let currentIsTarget = null;
  let timerId = null;
  let timeLeft = 0;
  let in10SecMode = false;
  let isGameActive = false;

  let correctStreak = 0;
  let maniaStreak = 0;

  // é€²æ—è§£é™¤æ¸ˆã¿ç®¡ç†ï¼ˆæ¶ˆã•ãªã„ä»•æ§˜ï¼‰
  const achievementsUnlocked = new Set();

  const gameArea = document.getElementById('game-area');
  const scoreDisplay = document.getElementById('score');
  const bestScoreDisplay = document.getElementById('best-score');
  const maniaBtn = document.getElementById('mania-btn');
  const seniorBtn = document.getElementById('senior-btn');
  const startNormalBtn = document.getElementById('start-normal-btn');
  const start10SecBtn = document.getElementById('start-10sec-btn');
  const timerDisplay = document.getElementById('timer');
  const achievementContainer = document.getElementById('achievement-container');
  const achievementList = document.getElementById('achievement-list');

  // é€²æ—ä¸€è¦§ï¼ˆãƒãƒ‹ã‚¢é€£ç¶š1ï½20ã¨ãã®ä»–ï¼‰
  const progressList = [
    ...Array.from({length: 20}, (_, i) => {
      const n = i + 1;
      return {
        name: `ãƒãƒ‹ã‚¢${n}é€£ç¶š`,
        condition: () => maniaStreak >= n,
        probPercent: (Math.pow(0.7, n) * 100).toFixed(1) + '%'
      };
    }),
    { name: 'é€£ç¶š100å›', condition: () => correctStreak >= 100 },
    { name: 'é€£ç¶š200å›', condition: () => correctStreak >= 200 },
    { name: 'é€£ç¶š300å›', condition: () => correctStreak >= 300 },
  ];

  function spawnIcon() {
    gameArea.innerHTML = '';
    const isTarget = Math.random() < 0.7;
    currentIsTarget = isTarget;

    const icon = document.createElement('img');
    icon.classList.add('icon');
    icon.src = isTarget ? 'images/target.png' : 'images/fake.png';

    const iconSize = Math.floor(Math.random() * 16) + 20;
    icon.style.width = `${iconSize}px`;
    icon.style.height = `${iconSize}px`;

    icon.style.top = `${Math.floor(Math.random() * (300 - iconSize))}px`;
    icon.style.left = `${Math.floor(Math.random() * (300 - iconSize))}px`;

    gameArea.appendChild(icon);
  }

  function updateScoreDisplay() {
    scoreDisplay.textContent = score;
    bestScoreDisplay.textContent = bestScore10sec;
  }

  function gameOver(message = 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼') {
    alert(message + ' ã‚¹ã‚³ã‚¢: ' + score);
    if (in10SecMode && score > bestScore10sec) {
      bestScore10sec = score;
      alert('æœ€é«˜ã‚¹ã‚³ã‚¢æ›´æ–°ï¼ğŸ‰ ' + bestScore10sec);
    }
    resetGame();
  }

  function resetGame() {
    clearInterval(timerId);
    timerId = null;
    timeLeft = 0;
    timerDisplay.textContent = '';
    score = 0;
    updateScoreDisplay();
    maniaBtn.disabled = true;
    seniorBtn.disabled = true;
    startNormalBtn.disabled = false;
    start10SecBtn.disabled = false;
    in10SecMode = false;
    isGameActive = false;

    correctStreak = 0;
    maniaStreak = 0;
    // achievementsUnlocked ã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„

    updateAchievementMenu();

    spawnIcon();
  }

  function checkAchievements() {
    for (const ach of progressList) {
      if (ach.condition() && !achievementsUnlocked.has(ach.name)) {
        achievementsUnlocked.add(ach.name);
        showAchievement(`é€²æ—è§£é™¤: ${ach.name} (ç¢ºç‡: ${ach.probPercent || ''})`);
        updateAchievementMenu();
      }
    }
  }

  function showAchievement(text) {
    const achievement = document.createElement('div');
    achievement.classList.add('achievement');
    achievement.textContent = text;
    achievementContainer.appendChild(achievement);

    setTimeout(() => {
      achievement.classList.add('show');
    }, 100);

    setTimeout(() => {
      achievement.classList.remove('show');
      setTimeout(() => {
        achievement.remove();
      }, 500);
    }, 3000);
  }

  function checkAnswer(isManiaSelected) {
    if ((currentIsTarget && isManiaSelected) || (!currentIsTarget && !isManiaSelected)) {
      score++;
      updateScoreDisplay();

      correctStreak++;
      if (currentIsTarget) {
        maniaStreak++;
      } else {
        maniaStreak = 0;
      }

      checkAchievements();
      spawnIcon();
    } else {
      gameOver();
    }
  }

  function startNormalMode() {
    in10SecMode = false;
    clearInterval(timerId);
    timerDisplay.textContent = '';
    score = 0;
    updateScoreDisplay();
    maniaBtn.disabled = false;
    seniorBtn.disabled = false;
    startNormalBtn.disabled = true;
    start10SecBtn.disabled = false;
    isGameActive = true;
    correctStreak = 0;
    maniaStreak = 0;
    // achievementsUnlocked ã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„
    updateAchievementMenu();
    spawnIcon();
  }

  function start10SecMode() {
    in10SecMode = true;
    score = 0;
    timeLeft = 10;
    updateScoreDisplay();
    timerDisplay.textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}ç§’`;
    maniaBtn.disabled = false;
    seniorBtn.disabled = false;
    startNormalBtn.disabled = false;
    start10SecBtn.disabled = true;
    isGameActive = true;
    correctStreak = 0;
    maniaStreak = 0;
    // achievementsUnlocked ã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„
    updateAchievementMenu();
    spawnIcon();

    timerId = setInterval(() => {
      timeLeft--;
      timerDisplay.textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}ç§’`;
      if (timeLeft <= 0) {
        clearInterval(timerId);
        timerId = null;
        gameOver('10ç§’ãƒ¢ãƒ¼ãƒ‰çµ‚äº†ï¼');
      }
    }, 1000);
  }

  maniaBtn.addEventListener('click', () => {
    if (isGameActive) checkAnswer(true);
  });

  seniorBtn.addEventListener('click', () => {
    if (isGameActive) checkAnswer(false);
  });

  startNormalBtn.addEventListener('click', startNormalMode);
  start10SecBtn.addEventListener('click', start10SecMode);

  document.addEventListener('keydown', (event) => {
    if (!isGameActive) return;
    if (event.key === 'f' || event.key === 'F') {
      checkAnswer(true);
    } else if (event.key === 'j' || event.key === 'J') {
      checkAnswer(false);
    }
  });

  function updateAchievementMenu() {
    achievementList.innerHTML = '';
    for (const ach of progressList) {
      const li = document.createElement('li');
      li.textContent = ach.name + (ach.probPercent ? ` (ç¢ºç‡: ${ach.probPercent})` : '');
      if (achievementsUnlocked.has(ach.name)) {
        li.classList.add('unlocked');
      } else {
        li.classList.add('locked');
      }
      achievementList.appendChild(li);
    }
  }

  resetGame();

</script>
</body>
</html>
